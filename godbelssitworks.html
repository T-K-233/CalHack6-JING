<html>
<body>
  <video id="cam_capture" autoplay></video>
  <canvas id="cvs"></canvas>
  <canvas id="cvs2"></canvas>
  
    
  <!-- Load TensorFlow.js -->
  <script src="https://unpkg.com/@tensorflow/tfjs"></script>
  <!-- Load Posenet -->
  <script src="https://unpkg.com/@tensorflow-models/posenet"></script>
  <script> 
    const videoWidth = 640;
    const videoHeight = 480;
    const netSettings = {
      scaleFactor: 0.50,
      flipHorizontal: true,
      outputStride: 16,
    };
    var ctx;
    var net;
    var startNet = async function(stream) {
      cam_capture.srcObject = stream;
      net = await posenet.load(
      {
        architecture: "ResNet50",
        outputStride: 16,
        inputResolution: 449,
        multiplier: 1,
        quantBytes: 2
      });
      
      var poseDetectionFrame = async function() {
        
        const pose = await net.estimatePoses(cam_capture, {
          flipHorizontal: true,
          decodingMethod: 'single-person'
        });
        console.log(pose[0]);
        console.log(pose[0].keypoints[0].position.x, pose[0].keypoints[0].position.y);
        requestAnimationFrame(poseDetectionFrame);
      }
      poseDetectionFrame();
    }

    var errorHandler = function(error) {
      console.log('navigator.MediaDevices.getUserMedia error: ', error.message, error.name);
    }
    var run = async function(net) {
      //ctx.drawImage(cam_capture, 0, 0, cvs.width, cvs.height);
      
      let pose = await net.estimatePoses(cam_capture, 
                      netSettings.scaleFactor, 
                      netSettings.flipHorizontal, 
                      netSettings.outputStride);
      
      //console.log(pose);
      run(net);
    }

    window.onload = function() {
      cvs.width = videoWidth;
      cvs.height = videoHeight;
      cam_capture.width = videoWidth;
      cam_capture.height = videoHeight;
      navigator.mediaDevices.getUserMedia({
        audio: false,
        video: {width: videoWidth, height: videoHeight}
      }).then(startNet).catch(errorHandler);
    };
  </script>
</body>
</html>